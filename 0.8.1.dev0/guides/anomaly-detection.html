<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Anomaly Detection &#8212; NuPIC 0.8.1.dev0
 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.8.1.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Docs" href="../api/index.html" />
    <link rel="prev" title="The Swarming Algorithm" href="swarming/algorithm.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="anomaly-detection">
<span id="anomaly-detection"></span><h1>Anomaly Detection<a class="headerlink" href="#anomaly-detection" title="Permalink to this headline">¶</a></h1>
<p>This technical note describes how the anomaly score is implemented and incorporated into the CLA (Cortical Learning Algorithm).</p>
<p>The anomaly score enables the CLA to provide a metric representing the degree to which each record is predictable. For example, if you have temporal anomaly model that is predicting the energy consumption of a building, each record will have an anomaly score between zero and one.  A zero represents a completely predicted value whereas a one represents a completely anomalous value.</p>
<p>The anomaly score feature of CLA is implemented on top of the core spatial and temporal memory, and don’t require any spatial pooler and temporal memory algorithm changes.</p>
<div class="section" id="temporalanomaly-model">
<span id="temporalanomaly-model"></span><h2>TemporalAnomaly model<a class="headerlink" href="#temporalanomaly-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<span id="description"></span><h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
<p>The user must specify the model as a TemporalAnomaly type to have the model report the anomaly score. The anomaly score uses the temporal memory to detect novel points in sequences. This will detect both novel input patterns (because they have not been seen in any sequence) as well as old spatial patterns that occur in a novel context.</p>
</div>
<div class="section" id="computation">
<span id="computation"></span><h3>Computation<a class="headerlink" href="#computation" title="Permalink to this headline">¶</a></h3>
<p>A TemporalAnomaly model calculates the anomaly score based on the correctness of the previous prediction. This is calculated as the percentage of active spatial pooler columns that were incorrectly predicted by the temporal memory.</p>
<p>The algorithm for the anomaly score is as follows:</p>
<p><img alt="equation" src="http://latex.codecogs.com/gif.latex?anomalyScore%3D%5Cfrac%7B%5Clvert%20A_t-%28P_%7Bt-1%7D%5Cbigcap%20A_t%29%5Crvert%20%7D%7B%5Clvert%20A_t%5Crvert%20%7D" /></p>
<p><img alt="equation" src="http://latex.codecogs.com/gif.latex?P_%7Bt-1%7D%3D%5Ctext%7BPredicted%20columns%20at%20time%20t%7D" /></p>
<p><img alt="equation" src="http://latex.codecogs.com/gif.latex?A_%7Bt%7D%3D%5Ctext%7BActive%20columns%20at%20time%20t%7D" /></p>
<p><strong>Note</strong>: Here, a &#8220;predicted column&#8221; is a column with a non-zero confidence value. This is not exactly the same as having a cell in the predicted state. For more information, refer the &#8220;predicted cells vs. confidences&#8221; section below.</p>
<p>Thus, an anomaly score of 1 means that no predicted cells became active and represents a completely anomalous record. A score of 0 means all predicted cells became active and represents a completely predicted record.</p>
</div>
<div class="section" id="rationale">
<span id="rationale"></span><h3>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h3>
<p>The reasoning behind this formulation of the anomaly score was that any record that is not predicted is a novel record. This holds if we have built the best predictive model possible, which we assume we have done via training/swarming.</p>
</div>
<div class="section" id="results">
<span id="results"></span><h3>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h3>
<p>This anomaly score has been applied to many datasets. It is the core mechanism used in Numenta&#8217;s commercial product Grok. In some cases you need to take a moving average of the anomaly score rather than just looking at the raw anomaly score. In NuPIC the example <code class="docutils literal"><span class="pre">examples/opf/clients/hotgym_anomaly</span></code> provides a good starting point to anomaly detection.  See also <a class="reference external" href="https://github.com/subutai/nupic.subutai/tree/master/swarm_examples">this set of examples</a> for swarming with anomaly detection models.</p>
</div>
<div class="section" id="confidences-vs-predicted-cells">
<span id="confidences-vs-predicted-cells"></span><h3>Confidences vs. Predicted Cells<a class="headerlink" href="#confidences-vs-predicted-cells" title="Permalink to this headline">¶</a></h3>
<div class="section" id="description">
<span id="id1"></span><h4>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h4>
<p>To compute the temporal anomaly score, the intention was to compute a normalized count of how many columns were active and not predicted. As an implementation shortcut, the set of predicted columns was computed by looking at columns with non-zero column &#8220;confidences.&#8221;</p>
<p>However, it was later discovered that columns with non-zero confidences don’t necessarily have any predicted cells in them. To figure out if a cell is in the predicted state, we use the hard match count (the number of active synapses, after taking into account the permanence threshold). However, to compute the confidences for a cell, the Temporal Pooler uses the soft match count (the number of active synapses, regardless of the permanence values). Therefore, the set of columns with non-zero confidences will always be a superset of the columns containing predicted cells.</p>
<p>When this difference was discovered (~April 2013), an option was added to the CLA to compute the anomaly score based on the predicted cells rather than using confidences.</p>
</div>
<div class="section" id="results">
<span id="id2"></span><h4>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h4>
<p>Some experiments using the predicted cells to compute the anomaly score were run on some experiments. However, because these predictions are a subset of the columns with non-zero confidences, the results necessarily had more false positives. As of the time of writing, no change has been made to the computation of the anomaly score based on these results. The anomaly score is still computed using column confidences.</p>
</div>
</div>
</div>
<div class="section" id="non-temporal-anomaly-detection">
<span id="non-temporal-anomaly-detection"></span><h2>Non-Temporal Anomaly Detection<a class="headerlink" href="#non-temporal-anomaly-detection" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<span id="id3"></span><h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
<p>There were also some attempts at adding anomaly detection that are &#8220;non-temporal&#8221; in nature by using the state of the spatial pooler. A non-temporal anomaly is defined as a combination of fields that doesn’t usually occur, independent of the history of the data.</p>
</div>
<div class="section" id="computation">
<span id="id4"></span><h3>Computation<a class="headerlink" href="#computation" title="Permalink to this headline">¶</a></h3>
<p>Since NontemporalAnomaly models have no temporal memory, the anomaly score is based on the state within the spatial pooler.</p>
<p>To compute the nontemporal anomaly score, we first compute the &#8220;match&#8221; score for each winning column after inhibition</p>
<p><img alt="equation" src="http://latex.codecogs.com/gif.latex?match_%7Bcol_%7Bk%7D%7D%20%3D%20overlap_%7Bcol_%7Bi%7D%7D*dutyCycle_%7Bcol_%7Bi%7D%7D" /></p>
<p>Then, to get the anomaly score (how unusual the data is), we take the inverse of the total matches</p>
<p><img alt="equation" src="http://latex.codecogs.com/gif.latex?anomalyScore%3D%28%5Csum%20_%7Bcol_%7Bi%7D%5Cepsilon%20winningCols%7Dmatch_%7Bcol_%7Bi%7D%7D+1%29%5E%7B-1%7D" /></p>
<p>The addition of 1 is to avoid divide by 0 errors.</p>
</div>
<div class="section" id="rationale">
<span id="id5"></span><h3>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h3>
<p>The purpose of this anomaly score was to detect input records that represented novel or rare input patterns (independent of the rest of the sequence). If an input pattern has a low overlap score with the winning columns, none of the columns match the input very well, indicating that the CLA has not seen a similar pattern before and this pattern is novel. Conversely, if they duty cycles for a given pattern are generally low, this indicates that a pattern has not been seen for a long time, indicating that it is rare.</p>
</div>
<div class="section" id="results">
<span id="id6"></span><h3>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h3>
<p>This algorithm was run on some artificial datasets. However, the results were not very promising, and this approach was abandoned. From a theoretical perspective the temporal anomaly detection technique is a superset of this technique. If a static pattern by itself is novel, by definition the temporal memory won&#8217;t make good predictions and hence the temporal anomaly score should be high. As such there was not too much interest in pursuing this route.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/numenta-logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">NuPIC</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=numenta&repo=nupic&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quick-start/index.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="opf.html">OPF Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="network.html">Network API Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="swarming/index.html">Swarming</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Anomaly Detection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#temporalanomaly-model">TemporalAnomaly model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#computation">Computation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rationale">Rationale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#results">Results</a></li>
<li class="toctree-l4"><a class="reference internal" href="#confidences-vs-predicted-cells">Confidences vs. Predicted Cells</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#non-temporal-anomaly-detection">Non-Temporal Anomaly Detection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#computation">Computation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rationale">Rationale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#results">Results</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Numenta.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/guides/anomaly-detection.md.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/numenta/nupic" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>