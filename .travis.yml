branches:
  except:
    - gh-pages
language: python
compiler:
  - gcc
python:
  - "2.6"
  - "2.7"
env:
  global:
    - NUPIC=$TRAVIS_BUILD_DIR
    - NTA=$HOME/nta/eng
    - PIP_IGNORE_INSTALLED=1

    # For S3 upload from travis-artifacts
    - ARTIFACTS_AWS_REGION=us-west-2
    - ARTIFACTS_S3_BUCKET=artifacts.numenta.org

    # ARTIFACTS_AWS_ACCESS_KEY_ID
    - secure: |-
        CJdye71QR+eexESMCd9FsEYB+7IGXkAoIZrJPALAMYhLoPixx5zm4FAFaazX
        vkBQORndufd5b3FTPswQ8Mzwo1epK0gh2H8f/uQzjSJOHa6FufYkpEuoz4wE
        W9eMAH+vxxsPIta2vA6Vyf4faouHZ+A1Bwou3y/EbEl7Rl5sK8g=

    # ARTIFACTS_AWS_SECRET_ACCESS_KEY
    - secure: |-
        lwl7bFPU6dIGWLJfDbnna3OQveRJOhbHKpL58XB3ld2qHQqpTWyYHyMaYHIe
        7ZP7GMJ/lPZyQOq9yWw6/lGEYT6TWEzgTxXH3wV6K+6zTkiCxno0aXMXk4f2
        Z8XjidLTydaxypFf3S05StGkmsb6e7dkvxOcu18khTP1dvV3Gd8=

notifications:
  irc: 
    channels: 
      - "irc.freenode.net#nupic"
  webhooks: http://issues.numenta.org:8081/travis

before_install:
  - source $NUPIC/env.sh
  - gem install travis-artifacts

install: "$NUPIC/build.sh"

script: 
  # legacy binary tests
  - "$NTA/bin/htmtest"
  # (not quite everything, really)
  - "$NTA/bin/testeverything"
  # actual unit tests
  - "$NUPIC/run_tests.sh -c"

  # run all example files
    # examples/bindings
  - "python $NUPIC/examples/bindings/sparse_matrix_how_to.py" 
  - "python $NUPIC/examples/bindings/sparse_pooler_how_to.py"  
##  - "python $NUPIC/examples/bindings/svm_how_to.py" # tkinter missing in Travis build machine
##  - "python $NUPIC/examples/bindings/temporal_pooler_how_to.py" # tkinter too
    # examples/opf (run atleast 1 from each category) 
  - "python $NUPIC/examples/opf/bin/OpfRunExperiment.py $NUPIC/examples/opf/experiments/anomaly/spatial/2field_few_skewed/"
  - "python $NUPIC/examples/opf/bin/OpfRunExperiment.py $NUPIC/examples/opf/experiments/anomaly/temporal/saw_200/"
  - "python $NUPIC/examples/opf/bin/OpfRunExperiment.py $NUPIC/examples/opf/experiments/classification/category_TP_1/"
  - "python $NUPIC/examples/opf/bin/OpfRunExperiment.py $NUPIC/examples/opf/experiments/missing_record/simple_0/"
  - "python $NUPIC/examples/opf/bin/OpfRunExperiment.py $NUPIC/examples/opf/experiments/multistep/hotgym/"
  - "python $NUPIC/examples/opf/bin/OpfRunExperiment.py $NUPIC/examples/opf/experiments/opfrunexperiment_test/simpleOPF/hotgym_1hr_agg/"
             # opf/experiments/params - skip now
  - "python $NUPIC/examples/opf/bin/OpfRunExperiment.py $NUPIC/examples/opf/experiments/spatial_classification/category_1/"
    # examples/prediction
  - "python $NUPIC/examples/prediction/RunExperiment.py $NUPIC/examples/prediction/experiments/dutyCycle/problem/"
    # examples/tp
  - "python $NUPIC/examples/tp/hello_tp.py"
  - "python $NUPIC/examples/tp/tp_test.py"

after_script:
- tar -zcf nupic-$TRAVIS_BUILD_NUMBER.tar.gz $NTA
# debug
- ls -l *.gz
- travis-artifacts upload --path nupic-$TRAVIS_BUILD_NUMBER.tar.gz --target-path artifacts/$TRAVIS_REPO_SLUG

